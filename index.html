<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Preview Shopee</title>
</head>
<body>
  <h2>Preview Sản phẩm Shopee</h2>
  <input type="text" id="input" placeholder="Dán link Shopee...">
  <button onclick="getShopee()">Lấy dữ liệu</button>

  <div id="result" style="margin-top:20px;"></div>

  <script>
    function extractShopeeIds(url) {
      const match = url.match(/product\/(\d+)\/(\d+)/);
      return match ? { shopid: match[1], itemid: match[2] } : null;
    }

    async function getShopee() {
      const url = document.getElementById('input').value;
      const ids = extractShopeeIds(url);
      if (!ids) return alert("Link không hợp lệ!");

      const res = await fetch(`/api/shopee?itemid=${ids.itemid}&shopid=${ids.shopid}`);
      const data = await res.json();

      if (data.error) {
        document.getElementById('result').innerText = "Không lấy được dữ liệu!";
        return;
      }

      document.getElementById('result').innerHTML = `
        <img src="${data.image}" width="150">
        <h3>${data.name}</h3>
        <p>Giá: ${data.price}K</p>
      `;
    }
  </script>
</body>
</html>
